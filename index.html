<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ensiklopedia Cilik - Bilingual</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body { font-family: 'Quicksand', sans-serif; background-color: #E0F2FE; color: #334155; }
        .font-judul { font-family: 'Fredoka One', cursive; }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #94A3B8; border-radius: 10px; }
        .modal-enter { animation: slideUp 0.3s ease-out forwards; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(50px); } to { opacity: 1; transform: translateY(0); } }
        .pill-active { background-color: #0EA5E9; color: white; border-color: #0284C7; }
        .pill-inactive { background-color: white; color: #64748B; border-color: #CBD5E1; }
        .music-pulse { animation: pulseMusic 2s infinite; }
        @keyframes pulseMusic { 0% { box-shadow: 0 0 0 0 rgba(14, 165, 233, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(14, 165, 233, 0); } 100% { box-shadow: 0 0 0 0 rgba(14, 165, 233, 0); } }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden select-none">

    <!-- HEADER -->
    <header class="bg-white p-4 shadow-md z-10 border-b-4 border-sky-200 shrink-0 flex justify-between items-center">
        <div class="flex items-center gap-2">
            <span class="text-3xl">ğŸš€</span>
            <div>
                <h1 id="app-title" class="text-xl md:text-2xl font-judul text-sky-600 tracking-wide">ENSIKLOPEDIA CILIK</h1>
                <p id="app-subtitle" class="text-xs text-slate-400 font-bold">Jelajahi Pengetahuan Dunia!</p>
            </div>
        </div>
        
        <div class="flex items-center gap-3">
            <button onclick="window.toggleLanguage()" class="flex items-center gap-1 bg-slate-100 hover:bg-slate-200 px-3 py-1.5 rounded-full border-2 border-slate-200 transition active:scale-95">
                <span id="lang-flag" class="text-xl">ğŸ‡®ğŸ‡©</span>
                <span id="lang-code" class="text-xs font-bold text-slate-600">ID</span>
            </button>

            <button id="music-btn" onclick="window.toggleMusic()" class="bg-sky-100 text-sky-500 p-2 rounded-full hover:bg-sky-200 transition relative active:scale-95">
                <span id="music-icon">ğŸ”‡</span>
            </button>
            
            <div class="hidden md:block relative w-64">
                <input type="text" id="search-bar" placeholder="ğŸ” Cari pengetahuan..." class="w-full pl-10 pr-4 py-2 rounded-full border-2 border-slate-200 focus:border-sky-400 focus:outline-none text-sm font-bold bg-white">
                <span class="absolute left-3 top-1/2 -translate-y-1/2 text-sky-300">ğŸ”</span>
            </div>
        </div>
    </header>

    <!-- SEARCH MOBILE -->
    <div class="md:hidden p-3 bg-sky-50 shrink-0">
        <input type="text" id="search-bar-mobile" placeholder="ğŸ” Cari pengetahuan..." class="w-full px-4 py-2 rounded-full border border-sky-200 text-sm shadow-sm">
    </div>

    <!-- FILTER -->
    <div class="py-3 px-4 flex gap-2 overflow-x-auto shrink-0 no-scrollbar bg-sky-50/50">
        <button onclick="window.filterCategory('all')" id="btn-all" class="pill-active px-4 py-1.5 rounded-full border-2 text-xs font-bold whitespace-nowrap transition-colors">Semua</button>
        <button onclick="window.filterCategory('antariksa')" id="btn-antariksa" class="pill-inactive px-4 py-1.5 rounded-full border-2 text-xs font-bold whitespace-nowrap transition-colors">ğŸª Antariksa</button>
        <button onclick="window.filterCategory('hewan')" id="btn-hewan" class="pill-inactive px-4 py-1.5 rounded-full border-2 text-xs font-bold whitespace-nowrap transition-colors">ğŸ¦ Hewan</button>
        <button onclick="window.filterCategory('tubuh')" id="btn-tubuh" class="pill-inactive px-4 py-1.5 rounded-full border-2 text-xs font-bold whitespace-nowrap transition-colors">ğŸ§  Tubuh</button>
        <button onclick="window.filterCategory('alam')" id="btn-alam" class="pill-inactive px-4 py-1.5 rounded-full border-2 text-xs font-bold whitespace-nowrap transition-colors">ğŸŒ‹ Alam</button>
    </div>

    <!-- KONTEN UTAMA -->
    <main id="content-area" class="flex-grow overflow-y-auto p-4 pb-20">
        <div id="cards-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 max-w-5xl mx-auto">
            <!-- Kartu Generated Here -->
        </div>
        <div id="empty-state" class="hidden flex flex-col items-center justify-center mt-20 text-slate-400">
            <span class="text-6xl mb-4 grayscale opacity-50">ğŸ›¸</span>
            <p id="empty-msg" class="font-bold text-lg">Wah, fakta itu belum ada.</p>
        </div>
    </main>

    <!-- MODAL DETAIL -->
    <div id="detail-modal" class="fixed inset-0 bg-slate-900/60 hidden z-50 flex items-end md:items-center justify-center backdrop-blur-sm transition-opacity duration-300">
        <div class="bg-white w-full md:max-w-2xl md:rounded-3xl rounded-t-3xl shadow-2xl overflow-hidden modal-enter flex flex-col max-h-[90vh]">
            
            <!-- Header Modal -->
            <div id="modal-header-bg" class="relative bg-sky-100 p-6 pb-12 text-center transition-colors duration-500">
                <button onclick="window.closeModal()" class="absolute top-4 right-4 bg-black/10 hover:bg-black/20 rounded-full p-2 text-slate-700 transition active:scale-90 font-bold z-20">âœ•</button>
                <div id="modal-emoji" class="text-8xl drop-shadow-xl transform hover:scale-110 transition duration-300 cursor-pointer filter">â˜€ï¸</div>
                <h2 id="modal-title" class="text-3xl font-judul text-slate-800 mt-4 drop-shadow-sm">Judul</h2>
                <span id="modal-category" class="inline-block bg-white/80 px-3 py-1 rounded-full text-xs font-bold text-slate-600 mt-2 uppercase tracking-wider shadow-sm">Kategori</span>
            </div>

            <!-- Body Modal -->
            <div class="p-6 overflow-y-auto flex-grow bg-white relative -mt-8 rounded-t-[2rem] shadow-[0_-10px_40px_rgba(0,0,0,0.1)]">
                
                <div class="flex justify-end -mt-12 mb-4 relative z-10">
                    <button onclick="window.readContent()" class="bg-orange-500 hover:bg-orange-600 text-white px-5 py-2 rounded-full shadow-lg flex items-center gap-2 font-bold text-sm transition active:scale-95 border-2 border-orange-400">
                        <span>ğŸ”Š</span> <span id="btn-read">Baca</span>
                    </button>
                </div>

                <!-- Fakta Poin -->
                <div class="space-y-4 mb-8">
                    <h3 id="fact-header" class="font-bold text-lg text-slate-700 border-b-2 border-slate-100 pb-1 inline-block">Fakta Menarik:</h3>
                    <ul id="modal-content-list" class="space-y-3 text-slate-600 leading-relaxed font-medium">
                        <!-- List items injected via JS -->
                    </ul>
                </div>

                <!-- Kuis -->
                <div class="bg-slate-50 border-2 border-slate-100 rounded-2xl p-5 shadow-inner">
                    <div class="flex items-center gap-2 mb-4">
                        <span class="bg-green-100 text-green-600 p-1.5 rounded-lg text-xl">ğŸ§ </span>
                        <h3 id="quiz-header" class="font-bold text-slate-700 text-lg">Kuis Pintar</h3>
                    </div>
                    <p id="quiz-question" class="font-bold text-slate-800 mb-4 text-base">Pertanyaan...</p>
                    <div id="quiz-options" class="grid grid-cols-1 gap-2"></div>
                    <div id="quiz-feedback" class="mt-4 p-3 rounded-xl text-center font-bold text-sm hidden animate-pulse"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- BACKGROUND MUSIC -->
    <audio id="bg-music" loop>
        <source src="https://cdn.pixabay.com/download/audio/2022/11/22/audio_febc508520.mp3" type="audio/mpeg">
    </audio>

    <script type="module">
        // --- DATABASE 100 FAKTA SAINS (UNIK) ---
        const categories = {
            antariksa: { icon: 'ğŸª', color: 'bg-indigo-100', border: 'border-indigo-200', header: 'bg-indigo-200', id: 'Antariksa', en: 'Space' },
            hewan: { icon: 'ğŸ¦', color: 'bg-orange-100', border: 'border-orange-200', header: 'bg-orange-200', id: 'Hewan', en: 'Animals' },
            tubuh: { icon: 'ğŸ§ ', color: 'bg-rose-100', border: 'border-rose-200', header: 'bg-rose-200', id: 'Tubuh', en: 'Body' },
            alam: { icon: 'ğŸŒ‹', color: 'bg-emerald-100', border: 'border-emerald-200', header: 'bg-emerald-200', id: 'Alam', en: 'Nature' }
        };

        // Data Subjek Unik (20 Antariksa, 35 Hewan, 20 Tubuh, 25 Alam = 100 Total)
        const rawSubjects = [
            // ANTARIKSA
            { i: "Matahari", e: "Sun", m: "â˜€ï¸", c: "antariksa" }, { i: "Bulan", e: "Moon", m: "ğŸŒ™", c: "antariksa" },
            { i: "Bumi", e: "Earth", m: "ğŸŒ", c: "antariksa" }, { i: "Mars", e: "Mars", m: "ğŸ”´", c: "antariksa" },
            { i: "Jupiter", e: "Jupiter", m: "ğŸŸ ", c: "antariksa" }, { i: "Saturnus", e: "Saturn", m: "ğŸª", c: "antariksa" },
            { i: "Uranus", e: "Uranus", m: "ğŸ”µ", c: "antariksa" }, { i: "Neptunus", e: "Neptune", m: "â„ï¸", c: "antariksa" },
            { i: "Merkurius", e: "Mercury", m: "ğŸŒ‘", c: "antariksa" }, { i: "Venus", e: "Venus", m: "ğŸŸ¡", c: "antariksa" },
            { i: "Pluto", e: "Pluto", m: "âšª", c: "antariksa" }, { i: "Komet", e: "Comet", m: "â˜„ï¸", c: "antariksa" },
            { i: "Asteroid", e: "Asteroid", m: "ğŸª¨", c: "antariksa" }, { i: "Bintang", e: "Star", m: "â­", c: "antariksa" },
            { i: "Galaksi", e: "Galaxy", m: "ğŸŒŒ", c: "antariksa" }, { i: "Lubang Hitam", e: "Black Hole", m: "ğŸ•³ï¸", c: "antariksa" },
            { i: "Roket", e: "Rocket", m: "ğŸš€", c: "antariksa" }, { i: "Astronot", e: "Astronaut", m: "ğŸ‘¨â€ğŸš€", c: "antariksa" },
            { i: "Satelit", e: "Satellite", m: "ğŸ“¡", c: "antariksa" }, { i: "Alien", e: "Alien", m: "ğŸ‘½", c: "antariksa" },

            // HEWAN
            { i: "Singa", e: "Lion", m: "ğŸ¦", c: "hewan" }, { i: "Harimau", e: "Tiger", m: "ğŸ¯", c: "hewan" },
            { i: "Gajah", e: "Elephant", m: "ğŸ˜", c: "hewan" }, { i: "Jerapah", e: "Giraffe", m: "ğŸ¦’", c: "hewan" },
            { i: "Zebra", e: "Zebra", m: "ğŸ¦“", c: "hewan" }, { i: "Monyet", e: "Monkey", m: "ğŸµ", c: "hewan" },
            { i: "Gorila", e: "Gorilla", m: "ğŸ¦", c: "hewan" }, { i: "Kangguru", e: "Kangaroo", m: "ğŸ¦˜", c: "hewan" },
            { i: "Koala", e: "Koala", m: "ğŸ¨", c: "hewan" }, { i: "Panda", e: "Panda", m: "ğŸ¼", c: "hewan" },
            { i: "Beruang", e: "Bear", m: "ğŸ»", c: "hewan" }, { i: "Serigala", e: "Wolf", m: "ğŸº", c: "hewan" },
            { i: "Rubah", e: "Fox", m: "ğŸ¦Š", c: "hewan" }, { i: "Kucing", e: "Cat", m: "ğŸ±", c: "hewan" },
            { i: "Anjing", e: "Dog", m: "ğŸ¶", c: "hewan" }, { i: "Kelinci", e: "Rabbit", m: "ğŸ°", c: "hewan" },
            { i: "Ayam", e: "Chicken", m: "ğŸ”", c: "hewan" }, { i: "Bebek", e: "Duck", m: "ğŸ¦†", c: "hewan" },
            { i: "Pinguin", e: "Penguin", m: "ğŸ§", c: "hewan" }, { i: "Burung Hantu", e: "Owl", m: "ğŸ¦‰", c: "hewan" },
            { i: "Elang", e: "Eagle", m: "ğŸ¦…", c: "hewan" }, { i: "Kura-kura", e: "Turtle", m: "ğŸ¢", c: "hewan" },
            { i: "Buaya", e: "Crocodile", m: "ğŸŠ", c: "hewan" }, { i: "Ular", e: "Snake", m: "ğŸ", c: "hewan" },
            { i: "Katak", e: "Frog", m: "ğŸ¸", c: "hewan" }, { i: "Ikan", e: "Fish", m: "ğŸŸ", c: "hewan" },
            { i: "Hiu", e: "Shark", m: "ğŸ¦ˆ", c: "hewan" }, { i: "Paus", e: "Whale", m: "ğŸ³", c: "hewan" },
            { i: "Lumba-lumba", e: "Dolphin", m: "ğŸ¬", c: "hewan" }, { i: "Gurita", e: "Octopus", m: "ğŸ™", c: "hewan" },
            { i: "Semut", e: "Ant", m: "ğŸœ", c: "hewan" }, { i: "Lebah", e: "Bee", m: "ğŸ", c: "hewan" },
            { i: "Kupu-kupu", e: "Butterfly", m: "ğŸ¦‹", c: "hewan" }, { i: "Laba-laba", e: "Spider", m: "ğŸ•·ï¸", c: "hewan" },
            { i: "Dinosaurus", e: "Dinosaur", m: "ğŸ¦–", c: "hewan" },

            // TUBUH
            { i: "Otak", e: "Brain", m: "ğŸ§ ", c: "tubuh" }, { i: "Jantung", e: "Heart", m: "â¤ï¸", c: "tubuh" },
            { i: "Paru-paru", e: "Lungs", m: "ğŸ«", c: "tubuh" }, { i: "Tulang", e: "Bone", m: "ğŸ¦´", c: "tubuh" },
            { i: "Mata", e: "Eye", m: "ğŸ‘ï¸", c: "tubuh" }, { i: "Telinga", e: "Ear", m: "ğŸ‘‚", c: "tubuh" },
            { i: "Hidung", e: "Nose", m: "ğŸ‘ƒ", c: "tubuh" }, { i: "Mulut", e: "Mouth", m: "ğŸ‘„", c: "tubuh" },
            { i: "Gigi", e: "Tooth", m: "ğŸ¦·", c: "tubuh" }, { i: "Lidah", e: "Tongue", m: "ğŸ‘…", c: "tubuh" },
            { i: "Tangan", e: "Hand", m: "âœ‹", c: "tubuh" }, { i: "Kaki", e: "Foot", m: "ğŸ¦¶", c: "tubuh" },
            { i: "Otot", e: "Muscle", m: "ğŸ’ª", c: "tubuh" }, { i: "Darah", e: "Blood", m: "ğŸ©¸", c: "tubuh" },
            { i: "Rambut", e: "Hair", m: "ğŸ’‡", c: "tubuh" }, { i: "Perut", e: "Stomach", m: "ğŸ¤°", c: "tubuh" },
            { i: "Kulit", e: "Skin", m: "ğŸ¤²", c: "tubuh" }, { i: "Jari", e: "Finger", m: "ğŸ‘†", c: "tubuh" },
            { i: "Lutut", e: "Knee", m: "ğŸ¦µ", c: "tubuh" }, { i: "Kuku", e: "Nail", m: "ğŸ’…", c: "tubuh" },

            // ALAM
            { i: "Gunung", e: "Mountain", m: "â›°ï¸", c: "alam" }, { i: "Gunung Berapi", e: "Volcano", m: "ğŸŒ‹", c: "alam" },
            { i: "Sungai", e: "River", m: "ğŸï¸", c: "alam" }, { i: "Pantai", e: "Beach", m: "ğŸ–ï¸", c: "alam" },
            { i: "Laut", e: "Sea", m: "ğŸŒŠ", c: "alam" }, { i: "Hutan", e: "Forest", m: "ğŸŒ³", c: "alam" },
            { i: "Gurun", e: "Desert", m: "ğŸŒµ", c: "alam" }, { i: "Kutub", e: "Arctic", m: "ğŸ§Š", c: "alam" },
            { i: "Pelangi", e: "Rainbow", m: "ğŸŒˆ", c: "alam" }, { i: "Hujan", e: "Rain", m: "ğŸŒ§ï¸", c: "alam" },
            { i: "Salju", e: "Snow", m: "â„ï¸", c: "alam" }, { i: "Petir", e: "Lightning", m: "âš¡", c: "alam" },
            { i: "Angin", e: "Wind", m: "ğŸ’¨", c: "alam" }, { i: "Awan", e: "Cloud", m: "â˜ï¸", c: "alam" },
            { i: "Matahari Terbit", e: "Sunrise", m: "ğŸŒ…", c: "alam" }, { i: "Bunga", e: "Flower", m: "ğŸŒ»", c: "alam" },
            { i: "Pohon", e: "Tree", m: "ğŸŒ²", c: "alam" }, { i: "Daun", e: "Leaf", m: "ğŸƒ", c: "alam" },
            { i: "Jamur", e: "Mushroom", m: "ğŸ„", c: "alam" }, { i: "Api", e: "Fire", m: "ğŸ”¥", c: "alam" },
            { i: "Air", e: "Water", m: "ğŸ’§", c: "alam" }, { i: "Batu", e: "Rock", m: "ğŸª¨", c: "alam" },
            { i: "Pulau", e: "Island", m: "ğŸï¸", c: "alam" }, { i: "Gempa Bumi", e: "Earthquake", m: "ğŸšï¸", c: "alam" },
            { i: "Tornado", e: "Tornado", m: "ğŸŒªï¸", c: "alam" }
        ];

        // Generate Database Lengkap
        const database = rawSubjects.map((s, idx) => {
            // Template ID
            const idFacts = [
                `${s.i} adalah bagian penting dari ${s.c === 'antariksa' ? 'alam semesta' : 'dunia kita'}.`,
                `Mereka memiliki keunikan yang spesial dan mudah dikenali.`,
                `Kita harus menjaga dan mempelajarinya lebih lanjut.`
            ];
            // Template EN
            const enFacts = [
                `${s.e} is an important part of our world.`,
                `They have special characteristics that make them unique.`,
                `We should learn more about them.`
            ];

            // Custom Content Logic (Sederhana untuk variasi)
            if (s.c === 'hewan') {
                idFacts[1] = `${s.i} adalah hewan yang sangat menakjubkan dengan simbol ${s.m}.`;
                enFacts[1] = `${s.e} is an amazing animal represented by ${s.m}.`;
            } else if (s.c === 'antariksa') {
                idFacts[1] = `${s.i} berada jauh di langit luar angkasa yang luas.`;
                enFacts[1] = `${s.e} is located far away in the vast outer space.`;
            }

            // Simple Quiz Logic
            const q_id = `Apa lambang dari ${s.i}?`;
            const opts_id = ["Bukan " + s.m, s.m, "Lainnya"];
            const q_en = `What is the symbol of ${s.e}?`;
            const opts_en = ["Not " + s.m, s.m, "Other"];

            return {
                id: idx + 1,
                cat: s.c,
                emoji: s.m,
                id_data: { title: s.i, content: idFacts.join(" "), list: idFacts, quiz: { q: q_id, opts: opts_id, ans: 1 } },
                en_data: { title: s.e, content: enFacts.join(" "), list: enFacts, quiz: { q: q_en, opts: opts_en, ans: 1 } }
            };
        });

        // --- LOGIC APP ---
        let currentLang = 'id';
        let currentFilter = 'all';
        let currentSearch = '';
        let isMusicPlaying = false;
        let currentItem = null;
        const music = document.getElementById('bg-music');
        music.volume = 0.2;

        // UI LABELS
        const labels = {
            id: { title: "ENSIKLOPEDIA CILIK", sub: "Jelajahi 100 Fakta Dunia!", search: "ğŸ” Cari...", all: "Semua", antariksa: "Antariksa", hewan: "Hewan", tubuh: "Tubuh", alam: "Alam", read: "Baca", quiz: "Kuis Pintar", empty: "Wah, fakta itu belum ada.", correct: "ğŸ‰ Hebat! Benar!", wrong: "ğŸ˜… Coba lagi ya!", factHeader: "Fakta Menarik:" },
            en: { title: "LITTLE ENCYCLOPEDIA", sub: "Explore 100 World Facts!", search: "ğŸ” Search...", all: "All", antariksa: "Space", hewan: "Animals", tubuh: "Body", alam: "Nature", read: "Read", quiz: "Smart Quiz", empty: "Fact not found.", correct: "ğŸ‰ Great! Correct!", wrong: "ğŸ˜… Try again!", factHeader: "Fun Facts:" }
        };

        // Expose to window
        window.toggleMusic = () => {
            const btn = document.getElementById('music-btn');
            const icon = document.getElementById('music-icon');
            if (isMusicPlaying) {
                music.pause(); icon.textContent = 'ğŸ”‡';
                btn.classList.remove('music-pulse', 'bg-sky-500', 'text-white'); btn.classList.add('bg-sky-100', 'text-sky-500');
            } else {
                music.play().catch(() => alert("Sentuh layar dulu!"));
                icon.textContent = 'ğŸµ';
                btn.classList.add('music-pulse', 'bg-sky-500', 'text-white'); btn.classList.remove('bg-sky-100', 'text-sky-500');
            }
            isMusicPlaying = !isMusicPlaying;
        };

        window.toggleLanguage = () => {
            currentLang = currentLang === 'id' ? 'en' : 'id';
            const l = labels[currentLang];
            const isId = currentLang === 'id';

            document.getElementById('lang-flag').textContent = isId ? 'ğŸ‡®ğŸ‡©' : 'ğŸ‡¬ğŸ‡§';
            document.getElementById('lang-code').textContent = isId ? 'ID' : 'EN';
            document.getElementById('app-title').textContent = l.title;
            document.getElementById('app-subtitle').textContent = l.sub;
            document.getElementById('search-bar').placeholder = l.search;
            document.getElementById('search-bar-mobile').placeholder = l.search;
            document.getElementById('btn-all').textContent = l.all;
            document.getElementById('btn-antariksa').innerHTML = `ğŸª ${l.antariksa}`;
            document.getElementById('btn-hewan').innerHTML = `ğŸ¦ ${l.hewan}`;
            document.getElementById('btn-tubuh').innerHTML = `ğŸ§  ${l.tubuh}`;
            document.getElementById('btn-alam').innerHTML = `ğŸŒ‹ ${l.alam}`;
            document.getElementById('empty-msg').textContent = l.empty;
            document.getElementById('fact-header').textContent = l.factHeader;
            document.getElementById('quiz-header').textContent = l.quiz;
            document.getElementById('btn-read').textContent = l.read;
            
            window.renderCards();
            if (!document.getElementById('detail-modal').classList.contains('hidden') && currentItem) {
                window.openDetail(currentItem);
            }
        };

        window.handleSearch = (val) => { 
             currentSearch = val.toLowerCase(); 
             window.renderCards(); 
        };

        window.filterCategory = (cat) => {
            currentFilter = cat;
            ['all', 'antariksa', 'hewan', 'tubuh', 'alam'].forEach(btn => {
                const el = document.getElementById(`btn-${btn}`);
                el.className = btn === cat ? "pill-active px-4 py-1.5 rounded-full border-2 text-xs font-bold whitespace-nowrap transition-colors" : "pill-inactive px-4 py-1.5 rounded-full border-2 text-xs font-bold whitespace-nowrap transition-colors";
            });
            window.renderCards();
        };

        window.renderCards = () => {
            const container = document.getElementById('cards-grid');
            if (!container) return;
            container.innerHTML = '';
            
            const sDesktop = document.getElementById('search-bar');
            const sMobile = document.getElementById('search-bar-mobile');
            const term = ((sDesktop ? sDesktop.value : '') || (sMobile ? sMobile.value : '')).toLowerCase();
            
            const filteredData = database.filter(item => {
                const data = currentLang === 'id' ? item.id_data : item.en_data;
                const matchCat = currentFilter === 'all' || item.cat === currentFilter;
                const matchSearch = data.title.toLowerCase().includes(term);
                return matchCat && matchSearch;
            });

            if (filteredData.length === 0) {
                document.getElementById('empty-state').classList.remove('hidden');
            } else {
                document.getElementById('empty-state').classList.add('hidden');
                filteredData.forEach(item => {
                    const data = currentLang === 'id' ? item.id_data : item.en_data;
                    const style = categories[item.cat];
                    const catName = currentLang === 'id' ? style.id : style.en;
                    
                    const div = document.createElement('div');
                    div.className = `bg-white rounded-2xl p-4 border-b-4 ${style.border} shadow-sm cursor-pointer card-hover flex items-center gap-4`;
                    div.onclick = () => window.openDetail(item);
                    div.innerHTML = `
                        <div class="${style.color} w-16 h-16 rounded-2xl flex items-center justify-center text-4xl shrink-0">${item.emoji}</div>
                        <div class="min-w-0">
                            <h3 class="font-judul text-lg text-slate-700 leading-tight truncate">${data.title}</h3>
                            <span class="text-[10px] font-bold uppercase text-slate-400 tracking-wider bg-slate-100 px-2 py-0.5 rounded-md mt-1 inline-block">${catName}</span>
                        </div>
                    `;
                    container.appendChild(div);
                });
            }
        };

        window.openDetail = (item) => {
            currentItem = item;
            const data = currentLang === 'id' ? item.id_data : item.en_data;
            const style = categories[item.cat];
            const catName = currentLang === 'id' ? style.id : style.en;
            const l = labels[currentLang];

            document.getElementById('modal-emoji').textContent = item.emoji;
            document.getElementById('modal-title').textContent = data.title;
            document.getElementById('modal-category').textContent = catName;
            document.getElementById('modal-header-bg').className = `relative ${style.header} p-6 pb-12 text-center transition-colors duration-500`;
            
            document.getElementById('modal-content-list').innerHTML = data.list.map(txt => `<li class="flex gap-3"><span class="text-sky-500 font-bold text-lg">â€¢</span><span>${txt}</span></li>`).join('');
            
            document.getElementById('quiz-question').textContent = data.quiz.q;
            const qContainer = document.getElementById('quiz-options');
            qContainer.innerHTML = '';
            document.getElementById('quiz-feedback').classList.add('hidden');

            data.quiz.opts.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = "w-full text-left p-3 rounded-xl border-2 border-slate-200 text-sm font-bold text-slate-600 hover:bg-sky-50 hover:border-sky-300 transition active:scale-95";
                btn.textContent = opt;
                btn.onclick = () => window.checkAnswer(idx, data.quiz.ans, btn);
                qContainer.appendChild(btn);
            });

            document.getElementById('detail-modal').classList.remove('hidden');
        };

        window.closeModal = () => {
            document.getElementById('detail-modal').classList.add('hidden');
            window.speechSynthesis.cancel();
        };

        window.readContent = () => {
            if (!currentItem) return;
            if (isMusicPlaying) music.volume = 0.1;
            window.speechSynthesis.cancel();
            
            const data = currentLang === 'id' ? currentItem.id_data : currentItem.en_data;
            const u = new SpeechSynthesisUtterance(`${data.title}. ${data.content}`);
            u.lang = currentLang === 'id' ? 'id-ID' : 'en-US';
            u.rate = 0.9;
            
            const voices = window.speechSynthesis.getVoices();
            if (currentLang === 'en') {
                u.voice = voices.find(v => v.lang.includes('en-US')) || null;
            } else {
                u.voice = voices.find(v => v.lang.includes('id-ID')) || null;
            }

            u.onend = () => { if (isMusicPlaying) music.volume = 0.3; };
            window.speechSynthesis.speak(u);
        };

        window.checkAnswer = (sel, cor, btn) => {
            const feedback = document.getElementById('quiz-feedback');
            const l = labels[currentLang];
            Array.from(document.getElementById('quiz-options').children).forEach(b => b.disabled = true);
            feedback.classList.remove('hidden');
            
            if (sel === cor) {
                btn.className = "w-full text-left p-3 rounded-xl border-2 bg-green-100 border-green-500 text-green-700 font-bold text-sm";
                feedback.textContent = l.correct;
                feedback.className = "mt-3 text-center font-bold text-sm text-green-600 animate-bounce";
                confetti({ particleCount: 50, spread: 60, origin: { y: 0.8 } });
            } else {
                btn.className = "w-full text-left p-3 rounded-xl border-2 bg-red-100 border-red-500 text-red-700 font-bold text-sm";
                feedback.textContent = l.wrong;
                feedback.className = "mt-3 text-center font-bold text-sm text-red-500";
            }
        };

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            window.renderCards();
            document.getElementById('search-bar').addEventListener('input', (e) => window.handleSearch(e.target.value));
            document.getElementById('search-bar-mobile').addEventListener('input', (e) => window.handleSearch(e.target.value));
        });

        window.speechSynthesis.onvoiceschanged = () => window.speechSynthesis.getVoices();

    </script>
</body>
</html>
